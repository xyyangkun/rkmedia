RKMEDIA_DEPENDENCIES =

RKMEDIA_CONF_OPTS = -DWARNINGS_AS_ERRORS=ON \
                    -DCMAKE_SHARED_LINKER_FLAGS="-L$(TARGET_DIR)/lib"

RKMEDIA_CONF_ENV = PKG_CONFIG_LIBDIR="$(TARGET_DIR)/lib/pkgconfig"

ifeq ($(RV_TARGET_RKMEDIA_MPP),y)
RKMEDIA_DEPENDENCIES += mpp
RKMEDIA_CONF_OPTS += -DRKMPP=ON \
    -DRKMPP_HEADER_DIR=$(TARGET_DIR)/include/mpp \
    -DRKMPP_LIB_NAME=mpp
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_MPP

ifeq ($(RV_TARGET_RKMEDIA_MPP_ENCODER),y)
RKMEDIA_CONF_OPTS += -DRKMPP_ENCODER=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_MPP_ENCODER

ifeq ($(RV_TARGET_RKMEDIA_MPP_DECODER),y)
RKMEDIA_CONF_OPTS += -DRKMPP_DECODER=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_MPP_DECODER

ifeq ($(RV_TARGET_RKMEDIA_OGG),y)
RKMEDIA_CONF_OPTS += -DOGG=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_OGG

RV_TARGET_RKMEDIA_OGGVORBIS =
ifeq ($(RV_TARGET_RKMEDIA_OGGVORBIS_DEMUXER),y)
RV_TARGET_RKMEDIA_OGGVORBIS=y
RKMEDIA_CONF_OPTS += -DOGGVORBIS=ON -DOGGVORBIS_DEMUXER=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_OGGVORBIS_DEMUXER

ifeq ($(RV_TARGET_RKMEDIA_OGGVORBIS_MUXER),y)
RV_TARGET_RKMEDIA_OGGVORBIS=y
RKMEDIA_CONF_OPTS += -DOGGVORBIS=ON -DOGGVORBIS_MUXER=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_OGGVORBIS_MUXER

ifeq ($(RV_TARGET_RKMEDIA_OGGVORBIS),y)
RKMEDIA_DEPENDENCIES += libvorbis
endif

ifeq ($(RV_TARGET_RKMEDIA_ALSA_PLAYBACK),y)
RKMEDIA_CONF_OPTS += -DALSA_PLAYBACK=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_ALSA_PLAYBACK

ifeq ($(RV_TARGET_RKMEDIA_ALSA_CAPTURE),y)
RKMEDIA_CONF_OPTS += -DALSA_CAPTURE=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_ALSA_CAPTURE

ifneq ($(RV_TARGET_RKMEDIA_ALSA_PLAYBACK)$(RV_TARGET_RKMEDIA_ALSA_CAPTURE),)
RKMEDIA_DEPENDENCIES += alsa-lib
endif

ifeq ($(RV_TARGET_RKMEDIA_LIVE555),y)
RKMEDIA_CONF_OPTS += -DLIVE555=ON \
    -DGROUPSOCK_HEADER_DIR=$(TARGET_DIR)/include/groupsock \
    -DUSAGEENVIRONMENT_HEADER_DIR=$(TARGET_DIR)/include/UsageEnvironment
RKMEDIA_DEPENDENCIES += live555
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_LIVE555

ifeq ($(RV_TARGET_RKMEDIA_RTSP_SERVER),y)
RKMEDIA_CONF_OPTS += -DLIVE555_SERVER=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_RTSP_SERVER

ifeq ($(RV_TARGET_RKMEDIA_RTSP_SERVER_H264),y)
RKMEDIA_CONF_OPTS += -DLIVE555_SERVER_H264=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_RTSP_SERVER_H264

ifeq ($(RV_TARGET_RKMEDIA_RTSP_SERVER_H265),y)
RKMEDIA_CONF_OPTS += -DLIVE555_SERVER_H265=ON
endif
RKMEDIA_CONFIGURE_DEP_CONFIGS += RV_TARGET_RKMEDIA_RTSP_SERVER_H265

NINJA := $(shell which ninja || type -p ninja)

ifneq ($(NINJA),)
NINJA_VERSION := $(shell ninja --version)
MIN_NINJA_VERSION := 1.5.1

ifeq ($(firstword $(sort $(NINJA_VERSION) $(MIN_NINJA_VERSION))),$(MIN_NINJA_VERSION))
RKMEDIA_CONF_OPTS += -G Ninja

ifeq ($(QUIET),)
RKMEDIA_MAKE_OPTS += -v
endif

define RKMEDIA_BUILD_CMDS
$(TARGET_MAKE_ENV) $($(PKG)_MAKE_ENV) $(NINJA) $($(PKG)_MAKE_OPTS) -C $($(PKG)_BUILDDIR)
endef

define RKMEDIA_INSTALL_TARGET_CMDS
$(NINJA) -C $($(PKG)_BUILDDIR) install
endef

endif
endif # ifneq ($(NINJA),)

RKMEDIA_TARGET_FILES = $(RKMEDIA_BUILDDIR)/libeasymedia.so

$(eval $(rv-generic-cmake))
